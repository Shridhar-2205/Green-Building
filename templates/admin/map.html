{% extends 'admin/master.html' %}
{% block body %}
{{ super() }}
{% if current_user.is_authenticated %}
<!-- Content Header (Page header) -->
<!-- Latest compiled and minified CSS -->
<section class="content-header">
   <h1>
      Infrastructure View
   </h1>
   <ol class="breadcrumb">
      <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
      <li class="active">Custom</li>
   </ol>
</section>
<section class="content">
   <section class="container-fluid">
      <div class="row">
         <div class="col-md-4 p-1">
            <div class="btn-group ">
               <div class="row">
                  <div class="btn-group col-auto">
                     <button onclick="if($('#add_building_div').is(':hidden')){$('.main_form').hide()}$('#add_building_div').slideToggle()"  class="btn btn-primary">Add Building</button>
                     <button onclick="if($('#add_cluster_div').is(':hidden')){$('.main_form').hide()}$('#add_cluster_div').slideToggle()" class="btn btn-primary">Add Cluster Node</button>
                     <button onclick="if($('#add_sensor_div').is(':hidden')){$('.main_form').hide()}$('#add_sensor_div').slideToggle()" class="btn btn-primary">Add Sensor Node</button>
                  </div>
               </div>
               <div class="row">
                  <div class="btn-group col-auto">
                     <button onclick="if($('#edit_building_div').is(':hidden')){$('.main_form').hide()}$('#edit_building_div').slideToggle()" class="btn btn-primary pd-5">Edit Building</button>
                     <button onclick="if($('#edit_cluster_div').is(':hidden')){$('.main_form').hide()}$('#edit_cluster_div').slideToggle()" class="btn btn-primary">Edit Cluster Node</button>
                     <button onclick="if($('#edit_sensor_div').is(':hidden')){$('.main_form').hide()}$('#edit_sensor_div').slideToggle()" class="btn btn-primary">Edit Sensor Node</button>
                  </div>
               </div>
               <div class="row">
                  <div class="btn-group col-auto">
                     <button onclick="if($('#remove_building_div').is(':hidden')){$('.main_form').hide()}$('#remove_building_div').slideToggle()" class="btn btn-primary">Remove Building</button>
                     <button onclick="if($('#remove_cluster_div').is(':hidden')){$('.main_form').hide()}$('#remove_cluster_div').slideToggle()" class="btn btn-primary">Remove Cluster</button>
                     <button onclick="if($('#remove_sensor_div').is(':hidden')){$('.main_form').hide()}$('#remove_sensor_div').slideToggle()" class="btn btn-primary">Remove Sensor</button>
                  </div>
               </div>
            </div>
            <div id="add_building_div" class="main_form" style="display:none">
               <form id="add_building_form" onsubmit="add_building();window.location.reload();return false;" method="POST">
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <label for="building_name">Building name</label>
                        <input type="text" class="form-control" name="building_name" id="building_name" placeholder="Building Name" required>
                     </div>
                  </div>
                  <div class="form-group col-md-6">
                     <label for="building_address">Address</label>
                     <input type="text" class="form-control"  name="address" id="building_address" placeholder="1600 Main St" required>
                  </div>
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <label for="inputCity" >City</label>
                        <input type="text" class="form-control" name="city"  id="inputCity" required>
                     </div>
                     <div class="form-group col-md-4">
                        <label for="inputState">State</label>
                        <select id="inputState"  name="state" class="form-control" required>
                           <option value="">N/A</option>
                           <option value="AK">Alaska</option>
                           <option value="AL">Alabama</option>
                           <option value="AR">Arkansas</option>
                           <option value="AZ">Arizona</option>
                           <option value="CA">California</option>
                           <option value="CO">Colorado</option>
                           <option value="CT">Connecticut</option>
                           <option value="DC">District of Columbia</option>
                           <option value="DE">Delaware</option>
                           <option value="FL">Florida</option>
                           <option value="GA">Georgia</option>
                           <option value="HI">Hawaii</option>
                           <option value="IA">Iowa</option>
                           <option value="ID">Idaho</option>
                           <option value="IL">Illinois</option>
                           <option value="IN">Indiana</option>
                           <option value="KS">Kansas</option>
                           <option value="KY">Kentucky</option>
                           <option value="LA">Louisiana</option>
                           <option value="MA">Massachusetts</option>
                           <option value="MD">Maryland</option>
                           <option value="ME">Maine</option>
                           <option value="MI">Michigan</option>
                           <option value="MN">Minnesota</option>
                           <option value="MO">Missouri</option>
                           <option value="MS">Mississippi</option>
                           <option value="MT">Montana</option>
                           <option value="NC">North Carolina</option>
                           <option value="ND">North Dakota</option>
                           <option value="NE">Nebraska</option>
                           <option value="NH">New Hampshire</option>
                           <option value="NJ">New Jersey</option>
                           <option value="NM">New Mexico</option>
                           <option value="NV">Nevada</option>
                           <option value="NY">New York</option>
                           <option value="OH">Ohio</option>
                           <option value="OK">Oklahoma</option>
                           <option value="OR">Oregon</option>
                           <option value="PA">Pennsylvania</option>
                           <option value="PR">Puerto Rico</option>
                           <option value="RI">Rhode Island</option>
                           <option value="SC">South Carolina</option>
                           <option value="SD">South Dakota</option>
                           <option value="TN">Tennessee</option>
                           <option value="TX">Texas</option>
                           <option value="UT">Utah</option>
                           <option value="VA">Virginia</option>
                           <option value="VT">Vermont</option>
                           <option value="WA">Washington</option>
                           <option value="WI">Wisconsin</option>
                           <option value="WV">West Virginia</option>
                           <option value="WY">Wyoming</option>
                        </select>
                     </div>
                     <div class="form-group col-md-4">
                        <label for="inputZip">Zip</label>
                        <input type="text" class="form-control"  name="zip" id="inputZip" required>
                     </div>
                  </div>
                  <div class="form-group col-md-2">
                     <button type="submit" class="btn btn-primary">Create Building</button>
                  </div>
               </form >
            </div>
            <div id="add_cluster_div"  class="main_form" style="display:none">
               <form id="add_cluster_form" onsubmit="add_cluster();window.location.reload(); return false;" method="POST">
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <!--list of buildings -->
                        <label for="inputBuilding">Building name</label>
                        <select id="add_building_id"  name="building_id" class="form-control" required>
                           <option value="">N/A</option>
                           {% for building in buildings %}
                           <option value="{{building.id}}">{{building.name}}&nbsp:&nbsp{{building.address}}</option>
                           {% endfor %}
                        </select>
                     </div>
                  </div>
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <label for="floor">Floor</label>
                        <input type="number" class="form-control"  name="floor" id="cluster_floor" placeholder="1" required>
                     </div>
                     <div class="form-group col-md-6">
                        <label for="ip" >Cluster node IP Address</label>
                        <input type="text" class="form-control" name="ip"  id="ip" required>
                     </div>
                  </div>
                  <div class="form-group col-md-2">
                     <button type="submit" class="btn btn-primary">Create Cluster Node</button>
                  </div>
               </form >
            </div>
            <div id="add_sensor_div"  class="main_form"  style="display:none">
               <form id="add_sensor_form" onsubmit="add_sensor();window.location.reload();return false;" method="POST">
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <!--list of buildings -->
                        <label for="inputBuilding">Building name</label>
                        <select id="inputBuilding"  name="building_id" class="form-control" required>
                           <option value="">N/A</option>
                           {% for building in buildings %}
                           <option value="{{building.id}}">{{building.name}}&nbsp:&nbsp{{building.address}}</option>
                           {% endfor %}
                        </select>
                     </div>
                  </div>
                  <div class="form-group col-md-6">
                     <label for="floor">Floor</label>
                     <input type="number" class="form-control"  name="floor" id="floor" placeholder="1" required>
                  </div>
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <label for="cluster_ip" >Cluster node IP Address</label>
                        <input type="text" class="form-control" name="cluster_ip"  id="cluster_ip" required>
                     </div>
                     <div class="form-group col-md-6">
                        <label for="ip" >Sensor IP Address</label>
                        <input type="text" class="form-control" name="sensor_ip"  id="sensor_ip" required>
                     </div>
                     <div class="form-group col-md-6">
                        <label for="edit_status" >Status</label>
                        <select id="edit_status"  name="status" class="form-control">
                           <option value="ON">ON</option>
                           <option value="OFF">OFF</option>
                        </select>
                     </div>
                  </div>
                  <div class="form-group col-md-2">
                     <button type="submit" class="btn btn-primary">Create Sensor Node</button>
                  </div>
               </form >
            </div>
            <div id="edit_building_div" class="main_form" style="display:none">
               <form id="edit_building_form" onsubmit="edit_building();window.location.reload();return false;" method="POST">
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <!--list of buildings -->
                        <label for="edit_building_id">Building name</label>
                        <select id="edit_building_id"  name="building_id" class="form-control" required>
                           <option value="">N/A</option>
                           {% for building in buildings %}
                           <option value="{{building.id}}">{{building.name}}&nbsp:&nbsp{{building.address}}</option>
                           {% endfor %}
                        </select>
                     </div>
                  </div>
                  <div class="form-group col-md-6">
                     <label for="building_address">New Name</label>
                     <input type="text" class="form-control"  name="new_name" >
                  </div>
                  <div class="form-group col-md-6">
                     <label for="building_address">Address</label>
                     <input type="text" class="form-control"  name="address">
                  </div>
                  <div class="form-row ">
                     <div class="form-group col-md-6">
                        <label for="inputCity" >City</label>
                        <input type="text" class="form-control" name="city">
                     </div>
                     <div class="form-group col-md-4">
                        <label for="editState">State</label>
                        <select id="editState"  name="state" class="form-control">
                           <option value="">N/A</option>
                           <option value="AK">Alaska</option>
                           <option value="AL">Alabama</option>
                           <option value="AR">Arkansas</option>
                           <option value="AZ">Arizona</option>
                           <option value="CA">California</option>
                           <option value="CO">Colorado</option>
                           <option value="CT">Connecticut</option>
                           <option value="DC">District of Columbia</option>
                           <option value="DE">Delaware</option>
                           <option value="FL">Florida</option>
                           <option value="GA">Georgia</option>
                           <option value="HI">Hawaii</option>
                           <option value="IA">Iowa</option>
                           <option value="ID">Idaho</option>
                           <option value="IL">Illinois</option>
                           <option value="IN">Indiana</option>
                           <option value="KS">Kansas</option>
                           <option value="KY">Kentucky</option>
                           <option value="LA">Louisiana</option>
                           <option value="MA">Massachusetts</option>
                           <option value="MD">Maryland</option>
                           <option value="ME">Maine</option>
                           <option value="MI">Michigan</option>
                           <option value="MN">Minnesota</option>
                           <option value="MO">Missouri</option>
                           <option value="MS">Mississippi</option>
                           <option value="MT">Montana</option>
                           <option value="NC">North Carolina</option>
                           <option value="ND">North Dakota</option>
                           <option value="NE">Nebraska</option>
                           <option value="NH">New Hampshire</option>
                           <option value="NJ">New Jersey</option>
                           <option value="NM">New Mexico</option>
                           <option value="NV">Nevada</option>
                           <option value="NY">New York</option>
                           <option value="OH">Ohio</option>
                           <option value="OK">Oklahoma</option>
                           <option value="OR">Oregon</option>
                           <option value="PA">Pennsylvania</option>
                           <option value="PR">Puerto Rico</option>
                           <option value="RI">Rhode Island</option>
                           <option value="SC">South Carolina</option>
                           <option value="SD">South Dakota</option>
                           <option value="TN">Tennessee</option>
                           <option value="TX">Texas</option>
                           <option value="UT">Utah</option>
                           <option value="VA">Virginia</option>
                           <option value="VT">Vermont</option>
                           <option value="WA">Washington</option>
                           <option value="WI">Wisconsin</option>
                           <option value="WV">West Virginia</option>
                           <option value="WY">Wyoming</option>
                        </select>
                     </div>
                  </div>
                  <div class="form-group col-md-4">
                     <label for="inputZip">Zip</label>
                     <input type="text" class="form-control "  name="zip">
                  </div>
                  <div class="row">
                     <div class="form-group ">
                        <button type="submit" class="btn btn-primary">Edit Building</button>
                     </div>
                  </div>
               </form >
            </div>
            <div id="edit_cluster_div"  class="main_form"  style="display:none">
               <form id="edit_cluster_form" onsubmit="edit_cluster();window.location.reload(); return false;" method="POST">
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <!--list of buildings -->
                        <label for="edit_cluster_id">Current Building</label>
                        <select id="edit_cluster_id"  name="building_id" class="form-control" required>
                           <option value="">N/A</option>
                           {% for building in buildings %}
                           <option value="{{building.id}}">{{building.name}}&nbsp:&nbsp{{building.address}}</option>
                           {% endfor %}
                        </select>
                     </div>
                     <div class="form-group col-md-6">
                        <!--list of buildings -->
                        <label for="edit_new_cluster_id">New Building</label>
                        <select id="edit_new_cluster_id"  name="new_building_id" class="form-control">
                           <option value="">N/A</option>
                           {% for building in buildings %}
                           <option value="{{building.id}}">{{building.name}}&nbsp:&nbsp{{building.address}}</option>
                           {% endfor %}
                        </select>
                     </div>
                  </div>
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <label for="floor">Current Floor</label>
                        <input type="number" class="form-control"  name="floor"  placeholder="1" required>
                     </div>
                     <div class="form-group col-md-6">
                        <label for="floor">New Floor</label>
                        <input type="number" class="form-control"  name="new_floor"  placeholder="1" >
                     </div>
                  </div>
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <label for="ip" >Old IP Address</label>
                        <input type="text" class="form-control" name="ip" required>
                     </div>
                     <div class="form-group col-md-6">
                        <label for="ip" >New IP Address</label>
                        <input type="text" class="form-control" name="new_ip">
                     </div>
                  </div>
                  <div class="form-group col-md-2">
                     <button type="submit" class="btn btn-primary">Update Cluster Node</button>
                  </div>
               </form >
            </div>
            <div id="edit_sensor_div"  class="main_form"  style="display:none">
               <form id="edit_sensor_form" onsubmit="edit_sensor();window.location.reload();return false;" method="POST">
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <!--list of buildings -->
                        <label for="edit_sensor_building">Old Building name</label>
                        <select id="edit_sensor_building"  name="building_id" class="form-control" required>
                           <option value="">N/A</option>
                           {% for building in buildings %}
                           <option value="{{building.id}}">{{building.name}}&nbsp:&nbsp{{building.address}}</option>
                           {% endfor %}
                        </select>
                     </div>
                     <div class="form-group col-md-6">
                        <!--list of buildings -->
                        <label for="edit_new_sensor_building">New Building name</label>
                        <select id="edit_new_sensor_building"  name="new_building_id" class="form-control">
                           <option value="">N/A</option>
                           {% for building in buildings %}
                           <option value="{{building.id}}">{{building.name}}&nbsp:&nbsp{{building.address}}</option>
                           {% endfor %}
                        </select>
                     </div>
                  </div>
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <label for="floor">Old Floor</label>
                        <input type="number" class="form-control"  name="floor"  placeholder="1" required>
                     </div>
                     <div class="form-group col-md-6">
                        <label for="floor">New Floor</label>
                        <input type="number" class="form-control"  name="new_floor" placeholder="1">
                     </div>
                  </div>
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <label for="cluster_ip" >Old Cluster node IP Address</label>
                        <input type="text" class="form-control" name="cluster_ip"  required>
                     </div>
                     <div class="form-group col-md-6">
                        <label for="cluster_ip" >New Cluster node IP Address</label>
                        <input type="text" class="form-control" name="new_cluster_ip" >
                     </div>
                  </div>
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <label for="ip" >Sensor IP Address</label>
                        <input type="text" class="form-control" name="sensor_ip"  required>
                     </div>
                     <div class="form-group col-md-6">
                        <label for="ip" >New Sensor IP Address</label>
                        <input type="text" class="form-control" name="new_sensor_ip" >
                     </div>
                  </div>
                  <div class="form-group col-md-2">
                     <button type="submit" class="btn btn-primary">Create Sensor Node</button>
                  </div>
               </form >
            </div>
            <div id="remove_building_div" class="main_form" style="display:none" >
               <form id="remove_building_form" class="form-inline"  onsubmit="return false;" method="POST">
                  <label for="inputBuilding">Building name</label>
                  <div class="row">
                     <div class="form-group ">
                        <!--list of buildings -->
                        <select   name="building_id" class="form-control col-md-6" required>
                           <option value="">N/A</option>
                           {% for building in buildings %}
                           <option value="{{building.id}}">{{building.name}}&nbsp:&nbsp{{building.address}}</option>
                           {% endfor %}
                        </select>
                     </div>
                     <button class="btn btn-primary col-md" data-toggle="modal" data-target="#myModal">Delete building</button>
                     <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                           <div class="modal-content">
                              <div class="modal-body">Are you sure to delete the building?</div>
                              <div class="modal-footer">
                                 <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                 <button type="button" onclick="remove_building()" class="btn btn-danger">Confirm</button>
                              </div>
                           </div>
                           <!-- /.modal-content -->
                        </div>
                        <!-- /.modal -->
                     </div>
                  </div>
               </form >
            </div>
            <div id="remove_cluster_div" class="main_form" style="display:none">
               <form id="remove_cluster_form" onsubmit="return false;" method="POST">
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <!--list of buildings -->
                        <label for="inputBuilding">Building name</label>
                        <select   name="building_id" class="form-control" required>
                           <option value="">N/A</option>
                           {% for building in buildings %}
                           <option value="{{building.id}}">{{building.name}}&nbsp:&nbsp{{building.address}}</option>
                           {% endfor %}
                        </select>
                     </div>
                  </div>
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <label for="floor">Floor</label>
                        <input type="number" class="form-control"  name="floor" placeholder="1" required>
                     </div>
                     <div class="form-group col-md-6">
                        <label for="ip" >Cluster node IP Address</label>
                        <input type="text" class="form-control" name="ip" required>
                     </div>
                  </div>
                  <div class="form-group col-md-2">
                     <button class="btn btn-primary col-md" data-toggle="modal" data-target="#deleteCluster">Delete cluster</button>
                     <div class="modal fade" id="deleteCluster" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                           <div class="modal-content">
                              <div class="modal-body">Are you sure to delete the building?</div>
                              <div class="modal-footer">
                                 <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                 <button type="button" onclick="remove_cluster()" class="btn btn-danger">Confirm</button>
                              </div>
                           </div>
                           <!-- /.modal-content -->
                        </div>
                        <!-- /.modal -->
                     </div>
                  </div>
               </form >
            </div>
            <!--END OF REMOVE CLUSTER-->
            <div id="remove_sensor_div"  class="main_form" style="display:none" >
               <form id="remove_sensor_form" onsubmit="return false;" method="POST">
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <!--list of buildings -->
                        <label for="remove_sensor_building">Building name</label>
                        <select id="remove_sensor_building"  name="building_id" class="form-control" required>
                           <option value="">N/A</option>
                           {% for building in buildings %}
                           <option value="{{building.id}}">{{building.name}}&nbsp:&nbsp{{building.address}}</option>
                           {% endfor %}
                        </select>
                     </div>
                  </div>
                  <div class="form-group col-md-6">
                     <label for="floor">Floor</label>
                     <input type="number" class="form-control"  name="floor" placeholder="1" required>
                  </div>
                  <div class="form-row">
                     <div class="form-group col-md-6">
                        <label for="cluster_ip" >Cluster node IP Address</label>
                        <input type="text" class="form-control" name="cluster_ip"  required>
                     </div>
                     <div class="form-group col-md-6">
                        <label for="ip" >Sensor IP Address</label>
                        <input type="text" class="form-control" name="sensor_ip" required>
                     </div>
                  </div>
                  <div class="form-group col-md-2">
                     <button class="btn btn-primary col-md" data-toggle="modal" data-target="#deleteSensor">Delete cluster</button>
                     <div class="modal fade" id="deleteSensor" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                           <div class="modal-content">
                              <div class="modal-body">Are you sure to delete the building?</div>
                              <div class="modal-footer">
                                 <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                 <button type="button" onclick="remove_sensor()" class="btn btn-danger">Confirm</button>
                              </div>
                           </div>
                           <!-- /.modal-content -->
                        </div>
                        <!-- /.modal -->
                     </div>
                  </div>
               </form >
            </div>
         </div>
         <div class="col-md-4 p-1">
            <!--cluster node display-->
            <!-- Root accordian -->
            <div class = "col-md-4" id="slide_list" style="display:none">
               <a href="#" id="view_building_name" class="list-group-item active">
               </a>
               <div id="view_cluster_name">
               </div>
            </div>
            <div class = "col-md-8">
               <div id="view_sensor_name">
               </div>
            </div>
            <!-- Root accordian ends here -->
            <!-- end cluster node display-->
         </div>
         <div class="col-md-4 p-1">
            <div class="map_canvas">
               <div id="map"  style="height:800px"></div>
            </div>
         </div>
      </div>
      <script>
         <!--base function used to upload form to the server-->
              function send_request(form_name,request_type){
              packet = $(form_name).serialize();
              $.ajax({
                           url:'/map_request',
                           data: packet+"&type="+request_type,
                           type:'POST',
                           success: function(response){
                             console.log(response)
                           },
                           error: function(error){
                             console.log(error)
                           }
             });
             }

            function add_building(){send_request("#add_building_form","add_building");}
            function add_cluster(){send_request("#add_cluster_form","add_cluster");}
            function add_sensor(){send_request("#add_sensor_form","add_sensor");}

            function edit_building(){send_request("#edit_building_form","edit_building");}
            function edit_cluster(){send_request("#edit_cluster_for","edit_cluster");}
            function edit_sensor(){send_request("#edit_sensor_form","edit_sensor");}

            function remove_building(){send_request("#remove_building_form","remove_building");location.reload(true);}
            function remove_cluster(){send_request("#remove_cluster_form","remove_cluster");location.reload(true);}
            function remove_sensor(){send_request("#remove_sensor_form","remove_sensor");location.reload(true);}
             function get_sensor(temp){
                $.ajax({
                  url:'/map_request',
                  data:"cluster_id="+temp+"&type=get_sensor",
                  type:'POST',
                  success: function(response){
                           var sensor_div = $('#view_sensor_name')
                            sensor_div.empty()
                            var sensor_data = JSON.parse(response)
                            for(i=0; i< sensor_data.length; i++){
                              console.log(sensor_data[i].ip)
                              var status = false
                              if(!sensor_data[i].status){
                                 status = false
                              }
                              else{
                                 status = sensor_data[i].status
                              }
                              var btn_txt="disable"
                              if(!status){btn_txt="enable"}

                              var cluster_a = $("<a/>")
                              .addClass("list-group-item")
                              .html("<p>Sensor IP:"+sensor_data[i].ip+"</p><button class='btn'>"+btn_txt+"</btn>")
                              .attr('href','#')
                              .attr('sensor_id',sensor_data[i].id)
                              .appendTo(sensor_div)

                            }
                    console.log(response)
                  },
                  error: function(error){
                    console.log(error)
                  }
                  });
             }

      </script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script>
         var map;
         var g_cluster_data;
         function initMap() {
           <!--create map-->
           map = new google.maps.Map(document.getElementById('map'), {
                 center: {lat: 37.3257, lng: -121.89},
                 <!--TODO change the center coord-->
                 zoom: 8
               });

         // Resize stuff...
         google.maps.event.addDomListener(window, "resize", function() {
           var center = map.getCenter();
           google.maps.event.trigger(map, "resize");
           map.setCenter(center);
         });

           <!--add building markers-->
         {% for building in buildings %}
               var infoWindow = new google.maps.InfoWindow();

               var myLatLng = {lat: {{building.lat}}, lng: {{building.lng}}};
               var marker = new google.maps.Marker({
                   position: myLatLng,
                   map: map,
                   title: "{{building.name}}"
               });
               marker.content = '<p>{{building.name}}</p><p>{{building.address}},{{building.city}},{{building.state}},{{building.zip}}</p>'
               marker.addListener('click', function() {
                     infoWindow.open(map, marker);
                   });

               google.maps.event.addListener(marker, 'click', function () {

                       infoWindow.setContent(this.content);
                       infoWindow.open(this.getMap(), this);
                       <!--clear previous result-->
                       $('#view_sensor_name').empty()
                       $('#slide_list').show()

                       $.ajax({
                       url:'/map_request',
                       data: "building_id={{building.id}}&type=get_cluster",
                       type:'POST',
                       success: function(response){
                         console.log(response)
                         $('#view_building_name').html("{{building.name}}")
                         var clusters_div = $('#view_cluster_name')
                         clusters_div.empty()
                         var cluster_data = JSON.parse(response)
                         for(i=0; i< cluster_data.length; i++){
                           console.log(cluster_data[i].floor)
                           var cluster_a = $("<a/>")
                           .addClass("list-group-item")
                           .html("<p>Floor&nbsp:&nbsp"+cluster_data[i].floor+"</p><p>IP&nbsp:&nbsp"+cluster_data[i].ip+"</p>")
                           .attr('href','#')
                           .attr('cluster_id',cluster_data[i].id)
                           .appendTo(clusters_div)
                           .click(function(){
                           get_sensor($(this).attr("cluster_id"))})
                         }

                       },
                       error: function(error){
                         console.log(error)
                       }
                       })
                   });
               marker.setMap(map);
         {% endfor %}
         }


      </script>
      <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAQIL1DWVW3Ke8_Ddzx8xxkjeUlBCAS9PQ&callback=initMap"
         async defer></script>
   </section>
</section>
<!-- /.content -->
{% else %}
<center>
    <section class="content" style="color: white">
        <div class="col-sm-12">
            <h1>Green Building</h1>

            <p>
               Please log in firsts to access the dashboard
            </p>

            {% if not current_user.is_authenticated %}

                <p>
                    <a class="btn btn-primary" href="{{ url_for('security.login') }}">Login</a> <a class="btn btn-default" href="{{ url_for('security.register') }}">Register</a>
                </p>
                {% endif %}
                <br>
                <p>
                    <a class="btn btn-primary" href="/"><i class="glyphicon glyphicon-chevron-left"></i> Back</a>
                </p>
            </div>
        </section>
    </center>

    <br><br><br><br><br><br><br><br><br>
    <br><br><br><br><br><br><br><br><br><br>
{% endif %}
{% endblock body %}